digraph comm_ic_fsm {
    node [shape=circle, fontname="Helvetica", fontsize=10.0];
    edge [fontname="Helvetica", fontsize=8.0];

    StartUp1 -> comm_seq_start [label="startup sequence #1", style=dashed, color=red];
    StartUp1 -> StartUp2 [label="next"];

    StartUp2 -> comm_seq_start [label="startup sequence #2", style=dashed, color=red];
    StartUp2 -> IDLE [label="next"]

    IDLE [peripheries=2];
    IDLE -> IDLE [label="tick 20ms"];
    IDLE -> comm_seq_start [label="update", style=dashed, color=red];
    IDLE -> StartUp1 [label="restart"];

    comm_wait -> comm_wait [label="wait for response"];
    comm_wait -> comm_seq_start [label="ack 2E8", style=dotted];
    comm_wait -> comm_seq_preamble [label="ack 699", style=dotted];
    comm_wait -> comm_seq_info [label="frame ack 699", style=dotted];

    comm_seq_start -> comm_seq_preamble [label="done"];
    comm_seq_start -> StartUp1 [label="sequence ended", style=dashed, color=green];
    comm_seq_start -> StartUp2 [label="sequence ended", style=dashed, color=green];
    comm_seq_start -> IDLE [label="sequence ended", style=dashed, color=green];
    comm_seq_start -> comm_wait [label="request 4D9", style=dotted];

    comm_seq_preamble -> comm_seq_info [label="done"];
    comm_seq_preamble -> comm_wait [label="request 6B9", style=dotted];

    comm_seq_info -> comm_seq_info [label="send sequence 6B9"];
    comm_seq_info -> comm_wait [label="frame finnished", style=dotted];
    comm_seq_info -> comm_seq_end [label="done"];

    comm_seq_end -> comm_seq_end [label="send frame end ack and closing packet", style=dashed];
    comm_seq_end -> comm_seq_start [label="done"];
}
